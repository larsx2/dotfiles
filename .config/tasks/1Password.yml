version: '3'

tasks:
  # ============================================================================
  # AUTHENTICATION & ACCOUNT
  # ============================================================================
  signin:
    desc: Sign in to 1Password
    cmds:
      - op signin {{.CLI_ARGS}}

  signout:
    desc: Sign out of 1Password
    cmds:
      - op signout {{.CLI_ARGS}}

  whoami:
    desc: Get information about the signed-in account
    cmds:
      - op whoami {{.CLI_ARGS}}

  account-list:
    desc: List all accounts configured on this device
    cmds:
      - op account list {{.CLI_ARGS}}

  account-get:
    desc: Get details about your account
    cmds:
      - op account get {{.CLI_ARGS}}

  account-add:
    desc: Add a new 1Password account
    cmds:
      - op account add {{.CLI_ARGS}}

  account-forget:
    desc: Remove a 1Password account from this device
    cmds:
      - op account forget {{.CLI_ARGS}}

  # ============================================================================
  # ITEMS
  # ============================================================================
  item-list:
    desc: List all items (use -- --vault <vault> to filter by vault)
    cmds:
      - op item list {{.CLI_ARGS}}

  item-get:
    desc: Get an item's details (use -- <item> or -- <item> --fields <field>)
    cmds:
      - op item get {{.CLI_ARGS}}

  item-create:
    desc: Create a new item (use -- --category <type> --title <title>)
    cmds:
      - op item create {{.CLI_ARGS}}

  item-edit:
    desc: Edit an item (use -- <item> <field>=<value>)
    cmds:
      - op item edit {{.CLI_ARGS}}

  item-delete:
    desc: Delete an item (use -- <item>, add --archive to archive instead)
    cmds:
      - op item delete {{.CLI_ARGS}}

  item-move:
    desc: Move an item between vaults (use -- <item> --destination-vault <vault>)
    cmds:
      - op item move {{.CLI_ARGS}}

  item-share:
    desc: Share an item (use -- <item>)
    cmds:
      - op item share {{.CLI_ARGS}}

  search:
    desc: Search items with fzf, copy password on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search password "{{.CLI_ARGS}}"

  search-otp:
    desc: Search items with fzf, copy OTP on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search otp "{{.CLI_ARGS}}"

  search-user:
    desc: Search items with fzf, copy username on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search username "{{.CLI_ARGS}}"

  # ============================================================================
  # ITEM TEMPLATES
  # ============================================================================
  template-list:
    desc: List available item templates
    cmds:
      - op item template list {{.CLI_ARGS}}

  template-get:
    desc: Get a specific template (use -- <template>)
    cmds:
      - op item template get {{.CLI_ARGS}}

  # ============================================================================
  # VAULTS
  # ============================================================================
  vault-list:
    desc: List all vaults
    cmds:
      - op vault list {{.CLI_ARGS}}

  vault-get:
    desc: Get details about a vault (use -- <vault>)
    cmds:
      - op vault get {{.CLI_ARGS}}

  vault-create:
    desc: Create a new vault (use -- <name>)
    cmds:
      - op vault create {{.CLI_ARGS}}

  vault-edit:
    desc: Edit a vault (use -- <vault> --name <new-name>)
    cmds:
      - op vault edit {{.CLI_ARGS}}

  vault-delete:
    desc: Delete a vault (use -- <vault>)
    cmds:
      - op vault delete {{.CLI_ARGS}}

  # ============================================================================
  # DOCUMENTS
  # ============================================================================
  document-list:
    desc: List all documents
    cmds:
      - op document list {{.CLI_ARGS}}

  document-get:
    desc: Download a document (use -- <document> --output <path>)
    cmds:
      - op document get {{.CLI_ARGS}}

  document-create:
    desc: Create/upload a document (use -- <file> --title <title>)
    cmds:
      - op document create {{.CLI_ARGS}}

  document-edit:
    desc: Edit a document (use -- <document> <file>)
    cmds:
      - op document edit {{.CLI_ARGS}}

  document-delete:
    desc: Delete a document (use -- <document>)
    cmds:
      - op document delete {{.CLI_ARGS}}

  # ============================================================================
  # SECRETS (read, inject, run)
  # ============================================================================
  read:
    desc: Read a secret reference (use -- "op://<vault>/<item>/<field>")
    cmds:
      - op read {{.CLI_ARGS}}

  inject:
    desc: Inject secrets into a config file (use -- -i <template> -o <output>)
    cmds:
      - op inject {{.CLI_ARGS}}

  run:
    desc: Pass secrets as env vars to a process (use -- --env-file <file> -- <command>)
    cmds:
      - op run {{.CLI_ARGS}}

  # ============================================================================
  # USERS (admin)
  # ============================================================================
  user-list:
    desc: List all users in the account
    cmds:
      - op user list {{.CLI_ARGS}}

  user-get:
    desc: Get details about a user (use -- <user>)
    cmds:
      - op user get {{.CLI_ARGS}}

  user-provision:
    desc: Provision a new user (use -- --email <email> --name <name>)
    cmds:
      - op user provision {{.CLI_ARGS}}

  user-confirm:
    desc: Confirm a user (use -- <user>)
    cmds:
      - op user confirm {{.CLI_ARGS}}

  user-edit:
    desc: Edit a user (use -- <user>)
    cmds:
      - op user edit {{.CLI_ARGS}}

  user-suspend:
    desc: Suspend a user (use -- <user>)
    cmds:
      - op user suspend {{.CLI_ARGS}}

  user-reactivate:
    desc: Reactivate a suspended user (use -- <user>)
    cmds:
      - op user reactivate {{.CLI_ARGS}}

  user-delete:
    desc: Delete a user (use -- <user>)
    cmds:
      - op user delete {{.CLI_ARGS}}

  # ============================================================================
  # GROUPS (admin)
  # ============================================================================
  group-list:
    desc: List all groups
    cmds:
      - op group list {{.CLI_ARGS}}

  group-get:
    desc: Get details about a group (use -- <group>)
    cmds:
      - op group get {{.CLI_ARGS}}

  group-create:
    desc: Create a group (use -- <name>)
    cmds:
      - op group create {{.CLI_ARGS}}

  group-edit:
    desc: Edit a group (use -- <group>)
    cmds:
      - op group edit {{.CLI_ARGS}}

  group-delete:
    desc: Delete a group (use -- <group>)
    cmds:
      - op group delete {{.CLI_ARGS}}

  # ============================================================================
  # CONNECT (server integration)
  # ============================================================================
  connect-server-list:
    desc: List Connect servers
    cmds:
      - op connect server list {{.CLI_ARGS}}

  connect-server-get:
    desc: Get details about a Connect server (use -- <server>)
    cmds:
      - op connect server get {{.CLI_ARGS}}

  connect-server-create:
    desc: Create a Connect server (use -- <name> --vaults <vault>)
    cmds:
      - op connect server create {{.CLI_ARGS}}

  connect-server-edit:
    desc: Edit a Connect server (use -- <server>)
    cmds:
      - op connect server edit {{.CLI_ARGS}}

  connect-server-delete:
    desc: Delete a Connect server (use -- <server>)
    cmds:
      - op connect server delete {{.CLI_ARGS}}

  connect-token-list:
    desc: List Connect tokens
    cmds:
      - op connect token list {{.CLI_ARGS}}

  connect-token-create:
    desc: Create a Connect token (use -- <name> --server <server>)
    cmds:
      - op connect token create {{.CLI_ARGS}}

  connect-token-edit:
    desc: Edit a Connect token (use -- <token>)
    cmds:
      - op connect token edit {{.CLI_ARGS}}

  connect-token-delete:
    desc: Delete a Connect token (use -- <token>)
    cmds:
      - op connect token delete {{.CLI_ARGS}}

  # ============================================================================
  # SERVICE ACCOUNTS
  # ============================================================================
  service-account-list:
    desc: List service accounts
    cmds:
      - op service-account list {{.CLI_ARGS}}

  service-account-create:
    desc: Create a service account (use -- --name <name>)
    cmds:
      - op service-account create {{.CLI_ARGS}}

  service-account-get:
    desc: Get details about a service account (use -- <account>)
    cmds:
      - op service-account get {{.CLI_ARGS}}

  service-account-delete:
    desc: Delete a service account (use -- <account>)
    cmds:
      - op service-account delete {{.CLI_ARGS}}

  # ============================================================================
  # EVENTS API
  # ============================================================================
  events-api-list:
    desc: List Events API integrations
    cmds:
      - op events-api list {{.CLI_ARGS}}

  events-api-create:
    desc: Create an Events API integration (use -- <name> --features <features>)
    cmds:
      - op events-api create {{.CLI_ARGS}}

  events-api-get:
    desc: Get details about an Events API integration (use -- <integration>)
    cmds:
      - op events-api get {{.CLI_ARGS}}

  events-api-edit:
    desc: Edit an Events API integration (use -- <integration>)
    cmds:
      - op events-api edit {{.CLI_ARGS}}

  events-api-delete:
    desc: Delete an Events API integration (use -- <integration>)
    cmds:
      - op events-api delete {{.CLI_ARGS}}

  # ============================================================================
  # PLUGINS
  # ============================================================================
  plugin-list:
    desc: List available shell plugins
    cmds:
      - op plugin list {{.CLI_ARGS}}

  plugin-init:
    desc: Initialize a shell plugin (use -- <plugin>)
    cmds:
      - op plugin init {{.CLI_ARGS}}

  plugin-run:
    desc: Run a command with plugin authentication (use -- <plugin> -- <command>)
    cmds:
      - op plugin run {{.CLI_ARGS}}

  # ============================================================================
  # UTILITIES
  # ============================================================================
  update:
    desc: Check for and download updates
    cmds:
      - op update {{.CLI_ARGS}}

  completion:
    desc: Generate shell completion (use -- bash|zsh|fish|powershell)
    cmds:
      - op completion {{.CLI_ARGS}}

  # ============================================================================
  # CONVENIENCE SHORTCUTS
  # ============================================================================
  password:
    desc: Get password for an item (use -- <item>)
    cmds:
      - op item get {{.CLI_ARGS}} --fields password --reveal

  otp:
    desc: Get one-time password for an item (use -- <item>)
    cmds:
      - op item get {{.CLI_ARGS}} --otp

  username:
    desc: Get username for an item (use -- <item>)
    cmds:
      - op item get {{.CLI_ARGS}} --fields username

  copy-password:
    desc: Copy password to clipboard (use -- <item>)
    cmds:
      - op item get {{.CLI_ARGS}} --fields password --reveal | pbcopy
      - echo "Password copied to clipboard"

  copy-otp:
    desc: Copy OTP to clipboard (use -- <item>)
    cmds:
      - op item get {{.CLI_ARGS}} --otp | pbcopy
      - echo "OTP copied to clipboard"

  generate:
    desc: Generate a random password (outputs to stdout)
    cmds:
      - |
        LC_ALL=C tr -dc 'A-Za-z0-9!@#$%^&*' </dev/urandom | head -c ${1:-24}
        echo

  list-json:
    desc: List all items in JSON format
    cmds:
      - op item list --format json {{.CLI_ARGS}}

  vault-list-json:
    desc: List all vaults in JSON format
    cmds:
      - op vault list --format json {{.CLI_ARGS}}
