version: '3'

tasks:
  # ============================================================================
  # AUTHENTICATION
  # ============================================================================
  signin:
    desc: Sign in to 1Password
    cmds:
      - op signin {{.CLI_ARGS}}

  signout:
    desc: Sign out of 1Password
    cmds:
      - op signout {{.CLI_ARGS}}

  whoami:
    desc: Get information about the signed-in account
    cmds:
      - op whoami {{.CLI_ARGS}}

  # ============================================================================
  # SEARCH (fzf-based)
  # ============================================================================
  search:
    desc: Search items with fzf, copy password on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search password "{{.CLI_ARGS}}"

  search-otp:
    desc: Search items with fzf, copy OTP on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search otp "{{.CLI_ARGS}}"

  search-user:
    desc: Search items with fzf, copy username on selection
    cmds:
      - ~/.config/tasks/scripts/1p-search username "{{.CLI_ARGS}}"

  # ============================================================================
  # ITEMS
  # ============================================================================
  item-list:
    desc: List all items (use -- --vault <vault> to filter by vault)
    cmds:
      - op item list {{.CLI_ARGS}}

  item-get:
    desc: Get an item's details (use -- <item> or -- <item> --fields <field>)
    cmds:
      - op item get {{.CLI_ARGS}}

  # ============================================================================
  # VAULTS
  # ============================================================================
  vault-list:
    desc: List all vaults
    cmds:
      - op vault list {{.CLI_ARGS}}

  # ============================================================================
  # SECRETS (read & run)
  # ============================================================================
  read:
    desc: Read a secret reference (use -- "op://<vault>/<item>/<field>")
    cmds:
      - op read {{.CLI_ARGS}}

  run:
    desc: Pass secrets as env vars to a process (use -- --env-file <file> -- <command>)
    cmds:
      - op run {{.CLI_ARGS}}
